<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>矩形树图</title>
  <meta name="keywords" content="G2, The Grammar of Graphics, 图形语法,图表绘制引擎,图表库,可视化,数据可视化,AntV,Data Visualization,visualization,visualisation, antd, ant, ant design, G6, 流程图, 关系图, 可视化规范, 地图, 河流图, 力导图, 网络图, UML图, 流图, 时序图, 图">
  <meta name="description" content="一套专业、简单、无限可能的可视化解决方案">
  <link rel="icon" href="https://zos.alipayobjects.com/rmsportal/oNtwPuEICFyCWUHztcOA.png" type="image/x-icon">
  <link rel="shortcut icon" href="https://zos.alipayobjects.com/rmsportal/oNtwPuEICFyCWUHztcOA.png" type="image/x-icon">
  <link rel="stylesheet" type="text/css" href="../../../../static/style.css" />
  <link rel="stylesheet" type="text/css" href="../../../../static/codemirror.css" />
  <link rel="stylesheet" type="text/css" href="../../../../static/tipuesearch/tipuesearch.css" >
  <script src="../../../../static/jquery.js"></script>
  <script src="../../../../static/tipuesearch/tipuesearch_set.js"></script>
  <script src="../../../../static/tipuesearch/tipuesearch.js"></script>
  <script src="https://g.alicdn.com/bui/??seajs/2.3.0/sea.js"></script>
  <script src="https://g.alicdn.com/bui/bui/1.1.17/config.js"></script>
  <script src="../../../../static/script.js"></script>
<script src="https://gw.alipayobjects.com/as/g/datavis/g2/2.3.13/index.js"></script>
</head>
<body><header id="header">
  <div class="nav-wrapper gradient-line">
    <div class="nav-content clearfix">
      <div class="pull-left">
        <a href="/index.html" class="nav-logo">
          <img src="https://zos.alipayobjects.com/rmsportal/aGpKpuxoGfZqJobMPLvj.svg">
          <span class="logo-text">AntV</span>
        </a>
        <div class="search-box">
          <form action="/search.html">
            <i class="iconfont icon-search"></i>
            <input type="text" name="q" id="tipue_search_input" autocomplete="off" required>
          </form>
        </div>
      </div>
      <div class="nav pull-right">
        <ul id="J_nav" class="clearfix nav-list">
          <li id="g2" class="nav-item">
            <a class="nav-item-link" href="/g2/doc/index.html">G2</a>
            <ul class="nav-sub-list fadeUp">
              <li class="nav-sub-item"><a href="/g2/doc/index.html">快速上手</a></li>
              <li class="nav-sub-item"><a href="/g2/doc/tutorial/start/index.html">使用教程</a></li>
              <li class="nav-sub-item"><a href="/g2/demo/index.html">图表示例</a></li>
              <li class="nav-sub-item"><a href="/g2/api/index.html">API</a></li>
              <li class="nav-sub-item"><a href="/g2/doc/history.html">更新日志</a></li>
            </ul>
          </li>
          <li id="g2-mobile" class="nav-item">
            <a class="nav-item-link" href="/g2-mobile/doc/index.html">G2-mobile</a>
            <ul class="nav-sub-list fadeUp">
              <li class="nav-sub-item"><a href="/g2-mobile/doc/index.html">快速上手</a></li>
              <li class="nav-sub-item"><a href="/g2-mobile/doc/tutorial/shape.html">使用教程</a></li>
              <li class="nav-sub-item"><a href="/g2-mobile/demo/index.html">图表示例</a></li>
              <li class="nav-sub-item"><a href="/g2-mobile/api/index.html">API</a></li>
              <li class="nav-sub-item"><a href="/g2-mobile/doc/history.html">更新日志</a></li>
            </ul>
          </li>
          <li id="g6" class="nav-item">
            <a class="nav-item-link" href="/g6/doc/index.html">G6</a>
            <ul class="nav-sub-list fadeUp">
              <li class="nav-sub-item"><a href="/g6/doc/index.html">快速上手</a></li>
              <li class="nav-sub-item"><a href="/g6/doc/tutorial/start/base.html">使用教程</a></li>
              <li class="nav-sub-item"><a href="/g6/demo/index.html">图表示例</a></li>
              <li class="nav-sub-item"><a href="/g6/api/index.html">API</a></li>
              <li class="nav-sub-item"><a href="/g6/doc/history.html">更新日志</a></li>
              <li class="nav-sub-item"><a href="/g6/tools/index.html" target="_blank">在线工具</a></li>
            </ul>
          </li>
          <li id="vis" class="nav-item hover last">
            <a class="nav-item-link" href="/vis/doc/chart/index.html">可视化基础</a>
            <ul class="nav-sub-list fadeUp">
              <li class="nav-sub-item"><a href="/vis/doc/chart/classify/compare.html">图表用法</a></li>
              <li class="nav-sub-item"><a href="/vis/doc/design/index.html">图表设计指引</a></li>
              <li class="nav-sub-item"><a href="/vis/doc/reference.html">经典文献</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
</header>
 
 

  <div class="main-container clearfix">
  <div class="doc-content vis-chart">
    <div class="doc-inner vis-chart">
      <h1>矩形树图</h1>
      <p><img src="https://os.alipayobjects.com/rmsportal/FnvUGbKsEPqztPm.jpg" /></p>
<h2 id="矩形树图的简介">矩形树图的简介</h2><p>矩形树图由马里兰大学教授Ben Shneiderman于上个世纪90年代提出，起初是为了找到一种有效了解磁盘空间使用情况的方法。
矩形树图适合展现具有层级关系的数据，能够直观体现同级之间的比较。一个Tree状结构转化为平面空间矩形的状态，就像一张地图，指引我们发现探索数据背后的故事。</p>
<p>矩形树图采用矩形表示层次结构里的节点，父子节点之间的层次关系用矩形之间的相互嵌套隐喻来表达。从根节点开始，屏幕空间根据相应的子节点数目被分为多个矩形，矩形的面积大小通常对应节点的属性。每个矩形又按照相应节点的子节点递归的进行分割，知道叶子节点为止。</p>
<p>矩形树图的好处在于，相比起传统的树形结构图，矩形树图能更有效得利用空间，并且拥有展示<code>占比</code>的功能。矩形树图的缺点在于，当分类占比太小的时候文本会变得很难排布。相比起分叉树图，矩形树图的树形数据结构表达的不够直观、明确。</p>
<p>矩形树图的布局算法非常多，而且经常为可视化工程师津津乐道。但介绍具体实现并不是AntV目前的职责，有兴趣的同学可以参见拓展阅读部分。</p>
<p>英文名：Treemap, Rectangular Tree</p>
<h2 id="矩形树图的构成">矩形树图的构成</h2><p><img style="float:right" class="article-img-3" src="https://os.alipayobjects.com/rmsportal/VmNFvGKUweJEykK.png" /></p>
<table class="struct-table">
  <tr>
    <th>图表类型</th>
    <th>矩形树图</th>
  </tr>
  <tr>
    <td>适合的数据</td>
    <td>带权的树形数据</td>
  </tr>
  <tr>
    <td>功能</td>
    <td>表示树形数据的树形关系，及各个分类的<code>占比</code>关系</td>
  </tr>
  <tr>
    <td>数据与图形的映射</td>
    <td>树形关系映射到位置，占比数值数据映射到大小。设置颜色增强分类的区分度
    </td>
  </tr>
  <tr>
    <td>适合的数据条数</td>
    <td>大于5个分类</td>
  </tr>
</table>

<div style="clear: both;"></div>

<h2 id="矩形树图的应用场景">矩形树图的应用场景</h2><h3 id="适合的场景">适合的场景</h3><p> <strong>适合展示带权的树形数据</strong>。</p>
<p>例子1：下图是2015年手机品牌及其下属手机型号的销量信息。</p>
<div id="c1"></div>
<div class="code hide">
$.getJSON('./data/mobile.json',function (data) {
        var Stat = G2.Stat;
        var chart = new G2.Chart({
          id: 'c1',
          width: 1000,
          height: 500,
          animate: false // 阻止动画
        });
        chart.source(data);
        chart.tooltip({
          map: {
            title: 'name',
            value: 'value'
          }
        });
        chart.axis(false);
        chart.legend(false);
        chart.polygon().position(Stat.treemap('1*value'))
          .color('name')
          .label('name')
          .style({
          stroke: '#fff',
          lineWidth: 1
        });;
        chart.render();
        function findNode (name,nodes) {
          var rst = null;
          for (var i = 0; i < nodes.length; i++) {
            var node = nodes[i];
            if (node.name === name) {
              rst = node;
            }
            if (!rst && node.children) {
              rst = findNode(name,node.children);
            }
            if (rst) {
              break;
            }
          }
          return rst;
        }
        var expanded = false;
        chart.on('plotclick',function(ev){
          var point = ev.data;
          if (point) {
            var name = point._origin.name;
            var node = findNode(name,data);
            var nodes;
            if (!expanded) { // 未展开
              if (node.children) {
                nodes = node.children;
              } else {
                nodes = [node];
              }
              chart.clear();
              chart.source(nodes);
              chart.polygon().position(Stat.treemap('1*value')).color(point.color)
                .label('name', {
                offset: -2,
                label:{
                  fontSize: 10
                }
              })
                .style({
                stroke: '#fff',
                lineWidth: 1
              });
              chart.render();
              expanded = true;
            } else { //已经展开
              chart.clear();
              chart.source(data);
              chart.polygon().position(Stat.treemap('1*value')).color('name')
                .label('name', {
                label: {
                  fontSize: 12
                }
              })
                .style({
                stroke: '#fff',
                lineWidth: 1
              });
              chart.render();
              expanded = false;
            }
          }
        });
      });
</div>

<p>说明：</p>
<ul>
<li>同一级别的树通过算法，按各自权重大小（手机销量占比）将坐标系分割成若干个矩形块，设置颜色增强分类的区分度。</li>
<li>交互，点击矩形块可下钻到子分支。</li>
</ul>
<h3 id="不适合的场景">不适合的场景</h3><p><strong>没有权重关系，且需要明显展示层级关系，用分叉树图更合适</strong> </p>
<p>例子2：某公司组织部门图。第一个图是用矩形树图绘制，没有权重，层次不清。第二个图用分叉树图绘制，部门组织层级清晰明了。</p>
<div id="c2"></div>
<div class="code hide">
var data =         
    [{
    "name": "总经理",
        "value":1
    },
    {
        "name": "运营总监",
        "value":1
    },
    {
        "name": "职能总监",
        "value":1
    },
    {
        "name": "人事部",
        "value":1
    },
    {
        "name": "行政部",
        "value":1
    },
    {
        "name": "财务部",
        "value":1
    },
    {
        "name": "服务总监",
        "value":1
    },
    {
        "name": "技术部",
        "value":1
    },
    {
        "name": "客服部",
        "value":1
    },
    {
        "name": "售后部",
        "value":1
    },
    {
        "name": "市场总监",
        "value":1
    },
    {
        "name": "企划部",
        "value":1
    },
    {
        "name": "推广部",
        "value":1
    },
    {
        "name": "广告部",
        "value":1
    },
    {
        "name": "公关部",
        "value":1
    }

    ];
    var Stat = G2.Stat;
    var chart = new G2.Chart({
        id: 'c2',
        width: 1000,
        height: 500,
        animate: false // 阻止动画
    });
    chart.source(data);
    chart.tooltip({
        map: {
        title: 'name',
        value: 'value'
        }
    });
    chart.axis(false);
    chart.legend(false);
    chart.polygon().position(Stat.treemap('1*value'))
        .color('name')
        .label('name')
        .style({
        stroke: '#fff',
        lineWidth: 1
    });;
    chart.render();
</div>


<div id="c3"></div>
<div class="code hide">
    var data = [{
    "name": "总经理",
    "children": [{
        "name": "运营总监",
        "children": [{
        "name": "职能总监",
        "children": [{
            "name": "人事部"
        },{
            "name": "行政部"
        },{
            "name": "财务部"
        }]
        },{
        "name": "服务总监",
        "children": [{
            "name": "技术部"
        },{
            "name": "客服部"
        },{
            "name": "售后部"
        }]
        },{
        "name": "市场总监",
        "children": [{
            "name": "企划部"
        },{
            "name": "推广部"
        },{
            "name": "广告部"
        },{
            "name": "公关部"
        }]
        }]
    }]
    }];
    var Layout = G2.Layout;
    var Stat = G2.Stat;
    var chart = new G2.Chart({
    id: 'c3',
    width: 1000,
    height: 500,
    animate: false,
    plotCfg: {
        margin: [20,50]
    }
    });
    // 不显示title
    chart.tooltip({
    title: null
    }); 
    // 不显示图例
    chart.legend(false);
    // 使用layout，用户可以自己编写自己的layout
    // 仅约定输出的节点 存在 id,x，y字段即可
    var layout = new Layout.Tree({
    nodes: data,
    dx: 80 / 1000 // 单位宽度，由于按照宽高 1来计算的，所以需要传入比例值
    });
    var nodes = layout.getNodes();
    var edges = layout.getEdges();
    // 首先绘制 edges，点要在边的上面
    // 创建单独的视图
    var edgeView = chart.createView();
    edgeView.source(edges);
    edgeView.coord().reflect(); // 
    edgeView.axis(false);
    edgeView.tooltip(false);
    // Stat.link 方法会生成 ..x, ..y的字段类型，数值范围是 0-1
    edgeView.edge()
    .position(Stat.link('source*target',nodes))
    .shape('vhv')
    .color('#ccc');
    // 自定义部门的图形
    G2.Shape.registShape('point', 'depart', {
    drawShape: function(cfg, group) {
        var x = cfg.x;
        var y = cfg.y;
        var width = 60;
        var height = 30;
        var shape = group.addShape('rect', {
        attrs: {
            x: x - width / 2,
            y: y - height / 2,
            width: width,
            height: height,
            fill: '#fff',
            stroke: 'black'
        }
        });
        return shape;
    }
    });
    // 创建节点视图
    var nodeView = chart.createView();
    nodeView.coord().reflect(); //'polar'
    nodeView.axis(false);
    // 节点的x,y范围是 0，1
    // 因为边的范围也是 0,1所以正好统一起来
    nodeView.source(nodes, {
    x: {min: 0,max:1},
    y: {min: 0, max:1},
    value: {min: 0}
    });
    nodeView.point().position('x*y').color('steelblue')
    .shape('depart')
    .label('name', {
    offset: 0
    })
    .tooltip('name');
    chart.render();
</div>

<h2 id="矩形树图与其他图表的对比">矩形树图与其他图表的对比</h2><h3 id="矩形树图和马赛克图">矩形树图和<a href="mosaic.html">马赛克图</a></h3><ul>
<li>矩形树图用于展示树形数据，是关系型数据。马赛克图用于分析列表数据，是非关系型数据。</li>
</ul>
<h3 id="矩形树图和分叉树图（分叉树图介绍敬请期待）">矩形树图和分叉树图（分叉树图介绍敬请期待）</h3><ul>
<li>矩形树图用于展示带权的数据，分叉树图用于展示不带权的数据</li>
<li>两个图表都用于展示层次数据，但是分叉树图展示的层次关系更清晰</li>
<li>矩形树图能更多的展现树形结构内部的占比关系，分叉树图没有这个能力</li>
</ul>
<h2 id="矩形树图的扩展阅读">矩形树图的扩展阅读</h2><ul>
<li><a href="https://github.com/mbostock/d3/wiki/%E7%9F%A9%E5%BD%A2%E6%A0%91%E5%B8%83%E5%B1%80">矩形树布局</a></li>
<li><a href="https://treemapart.wordpress.com/">treemapart</a></li>
<li><a href="http://www.datavizcatalogue.com/methods/treemap.html">treemap</a></li>
</ul>

      <h2 id="标签">标签</h2>
      <div>

        <ul class="vis-classify-list small clearfix">
          <li>
            <a href="../../../../vis/doc/chart/classify/compare.html">
              <span>比较类</span>
            </a>
          </li>
          <li>
            <a href="../../../../vis/doc/chart/classify/proportion.html">
              <span>占比类</span>
            </a>
          </li>
          <li>
            <a href="../../../../vis/doc/chart/classify/relation.html">
              <span>关联类</span>
            </a>
          </li>
        </ul>

      </div>
    </div>
  </div>
  <script type="text/javascript">
    $.fn.isOnScreen = function(){
      var win = $(window);
      var viewport = {
          top : win.scrollTop(),
          left : win.scrollLeft()
      };
      viewport.right = viewport.left + win.width();
      viewport.bottom = viewport.top + win.height();
      var bounds = this.offset();
      bounds.right = bounds.left + this.outerWidth();
      bounds.bottom = bounds.top + this.outerHeight();
      return (!(viewport.right < bounds.left || viewport.left > bounds.right || viewport.bottom < bounds.top || viewport.top > bounds.bottom));
    };
    function ReplaceAll(str, sptr, sptr1){
      while (str.indexOf(sptr) >= 0){
         str = str.replace(sptr, sptr1);
      }
      return str;
    }
    function lazyLoad(codes) {
      var isrun = [];
      tryRun();
      $(document).on('mousewheel',function(e){
        tryRun();
      });
      function tryRun(){
        codes.each(function(index,ele){
          if (isrun.indexOf(ele) === -1) {
            var $ele = $(ele);
            if ( $ele.isOnScreen() ) {
              setTimeout(function(){
                var t = $ele.html();
                t = ReplaceAll(t, '&lt;', '<');
                t = ReplaceAll(t, '&gt;', '>');
                t = ReplaceAll(t, '&amp;', '&');
                eval(t);
                $ele.hide();
              },500);
              isrun.push(ele);
            };
          };
        });
      }
    }
    var codes = $('.code');
    lazyLoad(codes);
  </script>

  </div>
 
  <div style="display:none;">
<script src="https://s11.cnzz.com/z_stat.php?id=1259109662&web_id=1259109662" language="JavaScript"></script>
<script src="https://a.alipayobjects.com/g/component/tracert/1.0.0/index.js"></script>
</div>
</body>
</html>